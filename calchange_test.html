<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Scal oncalchange Functional Test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src="javascripts/prototype.js" type="text/javascript"></script>
    <script src="javascripts/effects.js" type="text/javascript"></script>
    <script src="javascripts/scal.js" type="text/javascript"></script>
    <link rel="stylesheet" href="styles/scaltables.css" type="text/css" media="screen"/>
	<style type="text/css">
		html,html body {height:100%;}
		#container {
			width: 95%;
			margin: 0 auto;
			padding: 0px;
			height: 100%;
		}
		.samplecal {
			width: 100%;
			margin: 0 auto;
			padding: 0px;
			height: 100%;
        }
    </style> 
  </head>
  <body>
      <div id="container">
		<form name="scalform" id="scalform" method="post" action="#">
            <select name="month" id="month">

            </select>
            <select name="days" id="days">

            </select>
            <select name="years" id="years">

            </select>
		</form>
		<div class="scal tinyscal slick" id="samplecal">&nbsp;</div>
	</div>
    <script type="text/javascript" language="javascript">
        // <![CDATA[    
        var updateSelect = function(d){
						var dt = (d instanceof Date) ? d : d.date;
						buildSelect({
							month: dt.format('mmmm'),
							days: dt.format('dd'),
							years: dt.getFullYear()
						});
        };
        var options = Object.extend({
            oncalchange: updateSelect,
            titleformat:'mmmm yyyy',
            closebutton:'<img src="styles/images/close.gif" />',
            dayheadlength:2,
            prevbutton: '<img src="styles/images/prev.gif" />',
            nextbutton: '<img src="styles/images/next.gif" />',
            yearnext: '<img src="styles/images/nexty.gif" />',
            yearprev: '<img src="styles/images/prevy.gif" />',
            weekdaystart:0,
            tabular: true,
            planner: false
            });	
        var samplecal = new scal('samplecal', updateSelect, options);
				var optionFormat = '<option value="#{value}">#{value}</option>';
				updateSelect(samplecal.currentdate);
        var onSelChange = function(){
            var params = $('scalform').serialize(true);
            var d = new Date(params.month + ' ' + params.days + ', ' + params.years);
            samplecal.setCurrentDate(d);
        };
        $('years').observe('change', onSelChange);
        $('month').observe('change', onSelChange);
				$('days').observe('change', onSelChange);
				function buildSelect(params) {
					var selectParams = $H(params);
					var currentYear = selectParams.get('years');
					var selects = {
						month: Date.prototype.monthnames,
						years: $A($R(currentYear - 10, currentYear + 10)),
						days: $A($R(samplecal.firstofmonth, samplecal.lastofmonth))
					};
					selectParams.each(function(pair) {
						var select = $(pair.key);
						select.descendants().invoke('remove');
						var selected = 0;
						selects[pair.key].each(function(d,i){
							if(pair.key == 'days') { d = d.format('dd'); }
							select.insert(optionFormat.interpolate({value: d}));
							if(d == pair.value) {
								select.selectedIndex = i;
								selected = i;
							}	
						});
						select.options[selected].selected = true;
					});
				}
        // ]]>
    </script>
  </body>
</html>


